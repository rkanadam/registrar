<link rel="import" href="imports.html">
<dom-module id="registrar-app">
    <template>
        <style include="app-theme"></style>
        <style include="iron-flex iron-flex-alignment">

            .main-header {
                box-shadow: 0px 5px 6px -3px rgba(0, 0, 0, 0.4);
            }

            app-toolbar#wideLayoutToolbar paper-icon-button {
                padding: 5px;
                margin: 3px 0px 5px 0px;
            }

            paper-dialog.notificationAndInvites {
                width: 80vw;
                height: 60vh;
                overflow: auto;
                margin: 0px;
                padding: 0px;
                background: #EEE;
            }

            paper-dialog.notificationAndInvites .pink .paper-header {
                background-color: var(--paper-pink-a200);
                margin: -24px;
                padding: 12px;
                color: white;
                transition: height 0.2s;
            }

            paper-dialog.notificationAndInvites .pink .content {
                margin: 24px;
                padding: 12px;
                color: #000080;
                transition: height 0.2s;
            }

            .profile {
                @apply(--paper-font-body1);
                color: white;
                text-decoration: none;
                text-transform: uppercase;
            }

            .profile:hover {
                text-decoration: underline;
            }

        </style>

        <app-drawer-layout force-narrow>

            <app-drawer id="drawer">

                <app-toolbar></app-toolbar>

                <!-- Nav on mobile: side nav menu -->
                <paper-menu selected="{{page}}" attr-for-selected="name">
                    <template is="dom-repeat" items="{{tabs}}" as="tab">
                        <a href="#profile">
                            <paper-item name="{{tab}}">{{tab}}</paper-item>
                        </a>
                    </template>
                </paper-menu>

            </app-drawer>

            <app-header-layout>
                <app-header class="main-header">

                    <app-toolbar hidden$="{{wideLayout}}">
                        <paper-icon-button class="menu-button" icon="menu" drawer-toggle></paper-icon-button>
                        <div main-title></div>
                        <a href="#profile" class="profile">
                            <paper-icon-button icon="account-box" alt="User Name"
                                               title$="{{localize('signedInAs', 'name', profile.name, 'email', profile.email)}}"
                                               click="_showProfilePage()">Edit Profile
                            </paper-icon-button>
                        </a>
                        <paper-icon-button
                                hidden$="[[!_isProfileSelectorEnabled(profiles)]]"
                                icon="arrow-drop-down"
                                title="Show other profiles"
                                on-click="_showProfileSelector">
                        </paper-icon-button>

                    </app-toolbar>

                    <app-toolbar hidden$="{{!wideLayout}}" class="layout horizontal">
                        <paper-tabs selected="{{path}}" attr-for-selected="name">
                            <template is="dom-repeat" items="{{tabs}}" as="tab">
                                <paper-tab name="{{tab}}">{{localize(tab)}}</span>
                                </paper-tab>
                            </template>
                        </paper-tabs>
                        <div class="flex"></div>
                        <paper-tabs selected="{{path}}" attr-for-selected="name">
                            <paper-tab name="profile" class="flex">
                                <paper-icon-button icon="account-box" alt="User Name"
                                                   title$="{{localize('signedInAs', 'name', profile.name, 'email', profile.email)}}"
                                                   click="_showProfilePage()">Edit Profile
                                </paper-icon-button>
                                <span>[[profile.name]]</span>
                            </paper-tab>
                        </paper-tabs>
                        <paper-icon-button
                                hidden$="[[!_isProfileSelectorEnabled(profiles)]]"
                                icon="arrow-drop-down"
                                title="Show other profiles"
                                on-click="_showProfileSelector">
                        </paper-icon-button>
                    </app-toolbar>


                </app-header>
                <profile-selector-dialog id="profileSelector" auto-open selected-profile="{{profile}}"
                                         profiles="{{profiles}}"></profile-selector-dialog>
                <neon-animated-pages style="height: 90vh"
                                     selected="{{page}}"
                                     entry-animation="fade-in-animation"
                                     exit-animation="fade-out-animation"
                                     attr-for-selected="id"
                                     class="flex">
                    <profile-page id="profilePage" route="{{subroute}}" profile="{{profile}}"
                                  language="[[language]]"></profile-page>
                    <event-list-page id="eventListPage" route="{{subroute}}"
                                     language="[[language]]"></event-list-page>
                    <event-page id="eventPage" route="{{subroute}}"
                                language="[[language]]"></event-page>
                </neon-animated-pages>
            </app-header-layout>
        </app-drawer-layout>


        <iron-media-query query="min-width: 600px" query-matches="{{wideLayout}}"></iron-media-query>
        <iron-location hash="{{path}}"></iron-location>
    </template>
    <script>
        Polymer({

            is: 'registrar-app',

            properties: {

                wideLayout: {
                    type: Boolean,
                    value: false,
                    observer: 'onLayoutChange'
                },

                tabs: {
                    type: Array,
                    value: function () {
                        return ['notifications', 'events', 'reports', 'messages'];
                    }
                },

                profile: {
                    type: Object,
                    observer: '_onProfileChange'
                },

                profiles: {
                    type: Array,
                    value: [],
                },

                path: {
                    type: String,
                    observer: '_onPathChanged'
                },

                "page": {
                    type: String
                }
            },

            behaviors: [
                AppBehaviors.AppBehavior
            ],

            onLayoutChange: function (wide) {
                var drawer = this.$.drawer;

                if (wide && drawer.opened) {
                    drawer.opened = false;
                }
            },

            _isProfileSelectorEnabled: function (profiles) {
                return profiles && profiles.length > 1;
            },

            _showProfileSelector: function () {
                this.$.profileSelector.open();
            },

            _onProfileChange: function () {
                if (this.profile) {
                    if (!this.page) {
                        this.set("page", "profile");
                    }
                }
            },

            _onPathChanged: function (path) {
                if (!path) {
                    return;
                }
                var parts = _.compact(path.split("/"));

                var part = parts.shift();
                if (part === "profile") {
                    this.set("page", "profilePage");
                } else if (part === "events") {
                    if (parts.length === 0) {
                        this.set("page", "eventListPage");
                    }
                    if (parts.length === 1) {
                        this.$.eventPage.eventId = parts[0];
                        this.set("page", "eventPage");
                    }
                }
            }
        });

    </script>

</dom-module>