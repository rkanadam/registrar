<dom-module id="recursive-menu">
    <template>
        <style is="custom-style" include="app-theme">
            /*
            paper-submenu.selected paper-item {
                font-weight: bold;
                background-color: var(--divider-color);
            }
            */
        </style>
        <paper-menu id="menu" attr-for-selected="id" selected-item="{{selectedPage}}" selected="[[selectedPageId]]"
                    selected-class="selected">
            <template is="dom-repeat" items="[[items]]" as="menu" id="template">
                <template is="dom-if" if="[[!_hasChildren(menu.children)]]">
                    <paper-item id="[[menu.id]]" class="menu-trigger">
                        <a href="#[[menu.link]]" class="flex">
                            [[menu.label]]
                        </a>
                    </paper-item>
                </template>
                <template is="dom-if" if="[[_hasChildren(menu.children)]]">
                    <paper-submenu id="[[menu.id]]">
                        <paper-item id="[[menu.id]]" class="menu-trigger">
                            <a href="#[[menu.link]]" class="flex">
                                [[menu.label]]
                            </a>
                            <paper-icon-button icon="arrow-drop-down-circle"></paper-icon-button>
                        </paper-item>
                        <div style="padding-left: 20px" class="menu-content">
                            <recursive-menu items="[[menu.children]]"></recursive-menu>
                        </div>
                    </paper-submenu>
                </template>
            </template>
        </paper-menu>
    </template>
    <script>
        Polymer({
            is: 'recursive-menu',

            properties: {
                items: {
                    type: Array,
                    value: function () {
                        return [];
                    }
                }
            },

            behaviors: [AppBehaviors.PageNavigationBehavior],

            observers: [
                "_onItemsChanged(items.*)",
                "_onSelectedPageChanged(selectedPage)"
            ],

            _onSelectedPageChanged: function () {
                if (this.selectedPage) {
                    if (typeof(this.selectedPage.toggle) === "function") {
                        this.selectedPage.opened = true;
                        var submenu = this.selectedPage.querySelector("recursive-menu");
                        submenu.path = this.selectedPage.path;
                    }
                }
            },

            buildMenu: function (e) {
                debugger;
            },

            _onItemsChanged: function () {
                this.$.template.render ();
            },

            _hasChildren: function (children) {
                return children && children.length > 0;
            }
        });
    </script>
</dom-module>