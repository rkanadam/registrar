<script>
    var PageNavigationBehavior = {
        properties: {
            page: {
                type: String,
                observer: "_pageChanged"
            }
        },

        observers: [
            '_pageIdChanged(route, routeData.pageId)'
        ],

        _pageIdChanged: function (route, pageId) {
            if (route === undefined || pageId === undefined) {
                return;
            }
            if (!this._isRouteChangeApplicableToMe()) {
                return;
            }
            var page = this._getPage(pageId)
            if (page === undefined) {
                return;
            }
            if (this.page !== page) {
                this.set("page", page);
            }
        },

        _isRouteChangeApplicableToMe: function () {
            if (this.parentElement) {
                if (this.parentElement.attrForSelected) {
                    var myPageName = this.getAttribute(this.parentElement.attrForSelected);
                    return myPageName == this.parentElement.selected || myPageName == this.parentElement.fallbackSelection;
                }
            }
            return false;
        },

        _pageChanged: function (page) {
            if (page === undefined) {
                return "";
            }

            var hash = this._getHash(page);
            if (hash && hash[0] !== "/") {
                hash = "/" + hash;
            }
            if (this.$.route && this.$.route.route && this.$.route.route.path !== hash) {
                this.$.route.set("route.path", hash);
            }
        },

        _getPage: function (pageId) {
            if (!pageId) {
                return "list";
            }
            if (pageId === "new") {
                return "new";
            }
            return pageId;
        },

        _getHash: function (page) {
            switch (page) {
                case "list":
                    return "";
                case "new":
                    return "new";
                default:
                    return page;
            }
        }
    };
    AppBehaviors.PageNavigationBehavior = PageNavigationBehavior;
</script>